<ng-container *ngIf="vm$ | async as vm">
  <ion-header>
    <ion-toolbar>
      <ion-title> Intake </ion-title>
    </ion-toolbar>
    <ion-toolbar *ngIf="vm.knowsIntake">
      <ion-title size="small">
        Please enter your <br />
        target intake
      </ion-title>
    </ion-toolbar>
    <ion-toolbar *ngIf="!vm.knowsIntake">
      <ion-title size="small">Please enter your details</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <form [formGroup]="caloricIntakeForm">
      <ion-list *ngIf="!vm.knowsIntake">
        <ion-item lines="full">
          <ion-label>Birthdate</ion-label>
          <ion-datetime-button
            data-cy="datetime-button"
            datetime="datetime"
          ></ion-datetime-button>
        </ion-item>
        <ion-popover [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime
              formControlName="birthdate"
              presentation="date"
              id="datetime"
            ></ion-datetime>
          </ng-template>
        </ion-popover>
        <ion-item lines="full">
          <ion-label position="stacked">Gender</ion-label>
          <ion-select data-cy="gender-select" formControlName="gender">
            <ion-select-option
              *ngFor="let enum of gender | keyvalue"
              [value]="enum.value"
              >{{ enum.value }}</ion-select-option
            >
          </ion-select>
        </ion-item>
        <ion-item lines="full">
          <ion-label position="stacked">Height</ion-label>
          <ion-input
            data-cy="height-input"
            formControlName="heightInCm"
            type="number"
          >
          </ion-input>
          <ion-badge slot="end">CM</ion-badge>
        </ion-item>
        <ion-item lines="full">
          <ion-label position="stacked">Bodyweight</ion-label>
          <ion-input
            data-cy="weight-input"
            formControlName="weightInKg"
            type="number"
          >
          </ion-input>
          <ion-badge slot="end">KG</ion-badge>
        </ion-item>
        <ion-item lines="full">
          <ion-label position="stacked">Goal</ion-label>
          <ion-select data-cy="goal-select" formControlName="goal">
            <ion-select-option
              *ngFor="let enum of goal | keyvalue"
              [value]="enum.value"
              >{{ enum.value }}</ion-select-option
            >
          </ion-select>
        </ion-item>
        <ion-item lines="full">
          <ion-label position="stacked">Activity</ion-label>
          <ion-select data-cy="activity-select" formControlName="activityLevel">
            <ion-select-option
              *ngFor="let enum of activityLevel | keyvalue"
              [value]="enum.value"
              >{{ enum.value }}</ion-select-option
            >
          </ion-select>
        </ion-item>
      </ion-list>
    </form>

    <ng-container *ngIf="vm.knowsIntake">
      <ion-item lines="full">
        <ion-label position="stacked">Calories</ion-label>
        <ion-input data-cy="fixed-intake-input" [formControl]="fixedIntake" type="number"> </ion-input>
        <ion-badge slot="end">KCAL</ion-badge>
      </ion-item>
    </ng-container>
    <ion-button
      data-cy="confirm-button"
      expand="block"
      class="ion-margin"
      [disabled]="!vm.calorieSettings"
      (click)="onConfirm(vm.calorieSettings)"
    >
      {{ vm.knowsIntake ? "Save my Intake" : "Calculate my Intake" }}
    </ion-button>
  </ion-content>
</ng-container>
